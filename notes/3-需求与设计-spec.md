# 启动会话与角色设定

1. Prompt1 角色设定与目标对齐

```
你好! 现在的任务是: 我们要从零开始设计并实现 `issue2md` 工具。

你现在不仅是资深的Go工程师,更是一位经验丰富的产品经理。我有一个初步想法,需要你通过想我提问，帮助我澄清需求、挖掘边缘场景，最终目标是共创一份高质量的`spec.md`。

我的初步想法是: **做一个命令行工具,输入一个Github Issue/PR/Discussion的URL,它就能自动将其转换为Markdown文件。**

请开始你的提问。

```

- 这个 Prompt 的精妙之处在于：
    - 利用框架红利：我们省去了繁琐的上下文注入步骤，直接基于已加载的“宪法”和“手册”开始工作，这正是 AI 原生开发的高效之处。
    - 双重角色：赋予它“产品经理”的视角，引导它关注需求而非实现。
    - 任务导向：明确了“提问 - 澄清”的协作模式。

2. Prompt 2：回复与澄清

3. 最终确认与生成指令

```
你的考虑非常周全！这些细节决定了工具的好用程度。这是我的最终决定：

**1. URL识别：**
*   **必须自动识别。** 用户不需要手动指定类型，工具应解析URL结构来判断是Issue、PR还是Discussion。这是核心体验。

**2. 排序与结构：**
*   **评论排序：** 统一按时间**正序**。
*   **PR Review Comments：** 这是一个好问题。为了保持简单，**不需要**按Review分组，直接把所有Review Comments和其他Comments一起按时间线平铺展示即可。我们的目标是归档“发生了什么对话”。
*   **Discussion Answer：** 是的，如果某个评论被标记为Answer，请在Markdown中给它加一个显著的标记（如引用块或Emoji）。

**3. Markdown模板：**
*   你给出的模板结构非常棒，就按这个来！
*   请确保在文件头部包含YAML Frontmatter（如title, url, author, created_at），方便其他工具（如Hugo/Jekyll）解析。

**4. 错误处理：**
*   如果URL无效或资源不存在，直接报错退出，并在stderr输出清晰的错误信息。
*   **不需要**复杂的重试机制，保持CLI轻量。
*   API限流时，直接透传GitHub API的错误信息给用户即可。

**5. 命令行参数设计：**
*   你的设计大体不错，但有一点调整：为了符合Unix习惯，输出文件我想支持**位置参数**，同时也保留你的Flags建议。
*   **最终设计：**

    issue2md [flags] <url> [output_file]

    *   如果不提供 output_file，默认打印到 stdout。
    *   Flags:
        *   -enable-reactions (对应你的 --include-reactions)
        *   -enable-user-links (对应你的 --user-links)
        *   注意：Token**只**通过环境变量 `GITHUB_TOKEN` 获取，**不要**提供 --token 参数，以防在Shell历史中泄露密钥。
---

**现在，所有的需求都已清晰。**

请扮演“需求编译器”，执行以下操作：

1.  在项目根目录下创建一个名为 specs/001-core-functionality/ 的目录。
2.  在该目录下创建 spec.md 文件。内容必须包含：
    *   **用户故事**（含CLI和未来的Web版）
    *   **功能性需求**（涵盖我们讨论的所有细节：URL识别、Flags、Token、Markdown结构）
    *   **非功能性需求**（架构解耦、错误处理）
    *   **验收标准**（列出具体的测试Case）
    *   **输出格式示例**（包含你刚才设计的Markdown结构和Frontmatter）

请直接执行工具生成文件。

```


4. 生成初始目录结构与辅助文档