# 设备管理系统需求规格说明书
# Document Version: 1.0
# Last Updated: 2025-01-07

---

## 文档说明

本文档描述"设备管理系统"的功能需求、用户故事和成功标准。
**核心原则**: 完全与技术实现解耦，仅描述"做什么"和"为什么"，不涉及"怎么做"。

### 系统定位
本系统是一个硬件设备管理平台，用于管理 Frame（机框）、Blade（刀片）、Encode（编码卡）、Decode（解码盒）等设备。

### 核心约束
- 系统不处理视频流业务
- 30 个 Frame，每个 Frame 24 个 Blade 插槽（最多 720 个 Blade）
- 同时支持 2000 用户在线
- 所有设备位于同一局域网

---

## 一、核心概念定义

### Frame（机框）
机架式设备，可容纳多个 Blade 刀片。

### Blade（刀片）
插入 Frame 的功能板卡，包含 CPU、内存、磁盘、GPU 等资源。

### Encode（编码卡）
Blade 的子模块，负责采集和编码视频信号。与 Blade 是一对一关系。

### Decode（解码盒）
用户终端设备，用户通过它连接 Blade 获取视频流。

### 中继服务器
第三方代理服务，负责转发 Encode 和 Decode 之间的视频流。

---

## 二、用户故事

### 故事 1: 发现并注册新设备

**作为** 系统管理员
**我想要** 发现局域网内的 Frame 和 Encode 设备并注册到系统
**以便** 开始管理这些设备

**验收标准**:
- [ ] 可以在管理界面触发设备发现功能
- [ ] 发现功能能识别局域网内的 Frame 和 Encode
- [ ] 显示发现的设备列表（设备ID、类型、IP地址）
- [ ] 可以选择设备进行注册
- [ ] 注册时告知设备连接系统的地址信息
- [ ] 注册成功后设备状态显示为"在线"
- [ ] 已注册的设备不会重复注册

---

### 故事 2: 查看 Blade 实时状态

**作为** 系统管理员
**我想要** 查看 Blade 的实时状态
**以便** 了解设备的运行情况

**验收标准**:
- [ ] 可以看到所有 Frame 及其管理的 Blade 列表
- [ ] 显示 Blade 的在位状态（在位/不在位）
- [ ] 显示 Blade 的上电状态（上电/下电）
- [ ] 显示 Blade 的硬件信息:
  - CPU 型号、内存大小、磁盘容量、GPU 型号、序列号
  - 固件版本、驱动版本
- [ ] 显示 Blade 的资源使用率:
  - CPU 使用率
  - 内存使用率
  - GPU 使用率
  - 磁盘使用率
  - 温度
- [ ] 状态变化时界面自动更新
- [ ] 设备离线时有明确标识

---

### 故事 3: 配置 Blade 监控规则

**作为** 系统管理员
**我想要** 配置 Blade 资源监控的触发条件
**以便** 控制系统何时接收资源数据

**验收标准**:
- [ ] 可以配置资源监控阈值:
  - CPU 使用率阈值（如 80%）
  - 内存使用率阈值（如 85%）
  - GPU 使用率阈值（如 90%）
  - 温度阈值（如 75°C）
- [ ] 可以针对单个 Blade 配置
- [ ] 可以批量配置多个 Blade
- [ ] 配置保存后立即生效
- [ ] 可以查看和修改已有配置

---

### 故事 4: 分配 Blade 给用户

**作为** 系统管理员
**我想要** 将 Blade 分配给特定用户
**以便** 用户可以使用该 Blade

**验收标准**:
- [ ] 可以选择单个或多个 Blade 进行分配
- [ ] 可以选择目标用户
- [ ] 一个 Blade 只能分配给一个用户
- [ ] 一个用户可以拥有多个 Blade
- [ ] 分配时自动为 Blade 安装用户策略中指定的镜像
- [ ] 分配成功后 Blade 显示所属用户
- [ ] 用户分配记录可查询

---

### 故事 5: 收回用户的 Blade

**作为** 系统管理员
**我想要** 收回已分配给用户的 Blade
**以便** 重新分配给其他用户

**验收标准**:
- [ ] 可以选择已分配的 Blade 进行收回
- [ ] 收回时需要确认操作
- [ ] 收回后 Blade 状态变为"未分配"
- [ ] 支持批量收回
- [ ] 收回操作记录可查询

---

### 故事 6: 创建系统管理员账号

**作为** 超级管理员
**我想要** 创建新的系统管理员账号
**以便** 授权他人管理系统

**验收标准**:
- [ ] 创建时填写:
  - 用户名（必须唯一）
  - 密码（符合强度要求）
  - 显示名称
  - 角色（必须选择）
- [ ] 创建成功后账号立即可用
- [ ] 新用户可以登录管理界面
- [ ] 新用户只能看到其角色权限允许的功能

---

### 故事 7: 创建普通用户账号

**作为** 系统管理员
**我想要** 创建普通用户账号
**以便** 用户可以在 Decode 终端登录

**验收标准**:
- [ ] 创建时填写:
  - 用户名（必须唯一）
  - 密码
  - 显示名称
  - 用户策略（必须选择）
- [ ] 创建后可以为用户分配 Blade
- [ ] 用户可以使用该账号在 Decode 终端登录
- [ ] 用户登录后只能看到分配给自己的 Blade

---

### 故事 8: 定义角色和权限

**作为** 超级管理员
**我想要** 创建角色并配置权限
**以便** 控制不同管理员的功能访问

**验收标准**:
- [ ] 可以创建新角色
- [ ] 角色包含:
  - 角色名称
  - 角色描述
  - 页面权限（可以访问哪些页面）
  - 按钮权限（可以执行哪些操作）
- [ ] 可以编辑和删除角色
- [ ] 删除角色前检查是否有用户使用
- [ ] 创建管理员时必须选择角色
- [ ] 一个用户只能分配一个角色

---

### 故事 9: 定义用户策略

**作为** 系统管理员
**我想要** 创建用户策略
**以便** 定义用户可使用的资源类型和默认配置

**验收标准**:
- [ ] 可以创建新策略
- [ ] 策略包含:
  - 策略名称
  - 默认镜像配置
  - 网络配置（内网/互联网）
  - Blade 分类配置:
    - CPU 最低/推荐要求
    - 内存最低/推荐要求
    - 硬盘最低/推荐要求
- [ ] 可以编辑和删除策略
- [ ] 创建用户时必须选择策略
- [ ] 分配 Blade 时自动使用策略中的镜像配置

---

### 故事 10: 管理 Frame 和 Encode 版本

**作为** 系统管理员
**我想要** 查看和升级设备固件版本
**以便** 保持设备软件最新

**验收标准**:
- [ ] 可以查看所有设备的当前版本:
  - 固件版本
  - 驱动版本
  - 版本更新时间
- [ ] 可以上传新版本文件
- [ ] 可以选择单个或多个设备进行升级
- [ ] 可以检查版本兼容性
- [ ] 升级过程中显示进度
- [ ] 升级失败时支持回滚
- [ ] 支持灰度升级（先升级部分设备）
- [ ] 升级操作记录可查询

---

### 故事 11: 为 Blade 安装镜像

**作为** 系统
**我想要** 在分配 Blade 时自动安装用户策略指定的镜像
**以便** 用户可以直接使用配置好的 Blade

**验收标准**:
- [ ] 分配 Blade 时自动读取用户策略
- [ ] 自动调用镜像管理系统安装镜像
- [ ] 显示镜像安装进度
- [ ] 安装失败时给出明确提示
- [ ] 安装成功后 Blade 可以正常使用
- [ ] 镜像安装操作记录可查询

---

### 故事 12: 手动管理 Blade 镜像

**作为** 系统管理员
**我想要** 手动安装或卸载 Blade 镜像
**以便** 灵活管理 Blade 配置

**验收标准**:
- [ ] 可以选择 Blade 手动安装镜像
- [ ] 可以选择目标镜像
- [ ] 显示安装进度和结果
- [ ] 可以卸载 Blade 的镜像
- [ ] 卸载前需要确认
- [ ] 操作记录可查询

---

### 故事 13: 配置中继服务器

**作为** 系统管理员
**我想要** 配置中继服务器信息
**以便** Encode 和 Decode 可以通过中继服务器传输数据

**验收标准**:
- [ ] 可以配置中继服务器信息:
  - 服务器 IP
  - 端口
  - 协议类型
  - 认证信息
- [ ] 配置保存后自动下发给相关设备
- [ ] 可以查看和修改已有配置
- [ ] 配置变更记录可查询

---

### 故事 14: 用户在 Decode 终端登录

**作为** Decode 终端用户
**我想要** 使用用户名和密码登录系统
**以便** 获取授权访问 Blade 资源

**验收标准**:
- [ ] 可以输入用户名和密码
- [ ] 验证成功后返回访问令牌
- [ ] 令牌有有效期
- [ ] 令牌过期前可以刷新
- [ ] 登录失败时给出明确提示
- [ ] 支持退出登录

---

### 故事 15: 获取分配的 Blade 列表

**作为** Decode 终端用户
**我想要** 查看分配给我的 Blade 列表
**以便** 选择要连接的 Blade

**验收标准**:
- [ ] 登录后可以获取 Blade 列表
- [ ] 只显示分配给当前用户的 Blade
- [ ] 每个显示:
  - Blade ID
  - 所属 Frame
  - 槽位号
  - 硬件信息
  - 当前资源使用率
  - 关联的 Encode 信息
- [ ] 列表实时更新
- [ ] 可以根据状态筛选

---

### 故事 16: 获取中继服务器配置

**作为** Decode 终端用户
**我想要** 获取中继服务器配置
**以便** 连接到正确的中继服务器

**验收标准**:
- [ ] 登录后可以获取中继服务器配置
- [ ] 配置包含:
  - 服务器 IP
  - 端口
  - 协议类型
  - 认证信息
- [ ] 配置信息完整且有效

---

### 故事 17: 查看系统仪表盘

**作为** 系统管理员
**我想要** 在首页看到系统整体状态
**以便** 快速了解系统运行情况

**验收标准**:
- [ ] 显示设备在线率:
  - Frame 在线数量/总数量
  - Encode 在线数量/总数量
  - Blade 在位数量/总数量
- [ ] 显示资源使用统计:
  - 平均 CPU 使用率
  - 平均内存使用率
  - 平均温度
- [ ] 显示告警概览:
  - 今日告警数量
  - 当前活跃告警
- [ ] 显示用户统计:
  - 总用户数
  - 在线用户数
- [ ] 数据自动刷新

---

### 故事 18: 管理告警

**作为** 系统管理员
**我想要** 查看和处理告警
**以便** 及时处理设备故障

**验收标准**:
- [ ] 显示告警列表:
  - 告警时间
  - 告警级别（严重/警告/信息）
  - 告警设备
  - 告警内容
  - 告警状态（未处理/处理中/已处理）
- [ ] 支持按级别、设备、时间筛选
- [ ] 可以标记告警为已处理
- [ ] 可以添加处理备注
- [ ] 可以配置告警规则:
  - 温度阈值
  - 资源使用率阈值
  - 设备离线告警
- [ ] 严重告警有明显提醒

---

### 故事 19: 查看设备日志

**作为** 系统管理员
**我想要** 查看设备上报的日志
**以便** 排查设备问题

**验收标准**:
- [ ] 可以按设备筛选日志
- [ ] 可以按时间范围筛选
- [ ] 可以按日志级别筛选
- [ ] 支持关键词搜索
- [ ] 可以导出日志
- [ ] 日志保留时间可配置

---

### 故事 20: 查看操作审计记录

**作为** 审计员
**我想要** 查看管理员的操作记录
**以便** 追溯系统变更历史

**验收标准**:
- [ ] 显示操作记录:
  - 操作时间
  - 操作用户
  - 操作类型（创建/更新/删除）
  - 操作对象
  - 操作结果
  - 来源 IP
- [ ] 支持按用户、时间、对象类型筛选
- [ ] 记录完整且不可删除
- [ ] 可以导出记录

---

### 故事 21: 处理设备离线

**作为** 系统
**我想要** 检测并标记离线设备
**以便** 管理员了解设备状态

**验收标准**:
- [ ] 设备连接断开时标记为离线
- [ ] 离线设备有明确标识
- [ ] 离线设备在界面中置顶或单独显示
- [ ] 设备重新上线后自动恢复在线状态
- [ ] 设备频繁离线时产生告警

---

### 故事 22: 处理数据不一致

**作为** 系统
**我想要** 保持设备状态数据的一致性
**以便** 管理员看到的信息准确无误

**验收标准**:
- [ ] 以设备上报的状态为准
- [ ] 设备重连后自动同步状态
- [ ] 增量更新状态变化
- [ ] 同步过程有日志记录
- [ ] 同步失败时有明确提示

---

## 三、功能需求清单

### F1: 设备管理
- [ ] F1.1 设备发现（UDP 广播）
- [ ] F1.2 设备注册
- [ ] F1.3 设备在线状态监控
- [ ] F1.4 Blade 状态查看
- [ ] F1.5 Blade 监控配置
- [ ] F1.6 设备离线检测

### F2: 用户与权限管理
- [ ] F2.1 创建系统管理员
- [ ] F2.2 创建普通用户
- [ ] F2.3 角色管理（创建、编辑、删除）
- [ ] F2.4 权限配置（页面权限、按钮权限）
- [ ] F2.5 用户策略管理
- [ ] F2.6 用户登录认证
- [ ] F2.7 令牌管理

### F3: 资源分配管理
- [ ] F3.1 Blade 分配给用户
- [ ] F3.2 收回用户 Blade
- [ ] F3.3 批量分配
- [ ] F3.4 批量收回
- [ ] F3.5 分配记录查询

### F4: 版本管理
- [ ] F4.1 查看设备版本
- [ ] F4.2 上传新版本
- [ ] F4.3 版本推送
- [ ] F4.4 版本回滚
- [ ] F4.5 灰度升级
- [ ] F4.6 版本兼容性检查

### F5: 镜像管理集成
- [ ] F5.1 自动安装镜像（分配 Blade 时）
- [ ] F5.2 手动安装镜像
- [ ] F5.3 卸载镜像
- [ ] F5.4 镜像安装状态查询

### F6: 中继服务器管理
- [ ] F6.1 配置中继服务器
- [ ] F6.2 下发配置到设备
- [ ] F6.3 配置变更记录

### F7: Decode 终端 API
- [ ] F7.1 用户登录
- [ ] F7.2 获取 Blade 列表
- [ ] F7.3 获取中继服务器配置
- [ ] F7.4 令牌刷新

### F8: 监控与告警
- [ ] F8.1 仪表盘统计
- [ ] F8.2 告警规则配置
- [ ] F8.3 告警通知
- [ ] F8.4 告警处理
- [ ] F8.5 告警历史查询

### F9: 日志与审计
- [ ] F9.1 设备日志查询
- [ ] F9.2 操作审计记录
- [ ] F9.3 日志导出
- [ ] F9.4 日志保留策略

### F10: 数据同步
- [ ] F10.1 设备状态同步
- [ ] F10.2 增量更新
- [ ] F10.3 数据一致性校验

---

## 四、非功能性需求

### NF1: 性能
- [ ] NF1.1 支持 2000 用户同时在线
- [ ] NF1.2 状态更新延迟 < 1 秒
- [ ] NF1.3 API 响应时间 < 500ms（P95）
- [ ] NF1.4 页面加载时间 < 2 秒

### NF2: 可靠性
- [ ] NF2.1 系统可用性 > 99.5%
- [ ] NF2.2 设备离线检测时间 < 30 秒
- [ ] NF2.3 数据备份机制
- [ ] NF2.4 故障自动恢复

### NF3: 安全性
- [ ] NF3.1 密码加密存储
- [ ] NF3.2 登录失败限制
- [ ] NF3.3 操作权限验证
- [ ] NF3.4 敏感操作审计
- [ ] NF3.5 数据传输加密

### NF4: 易用性
- [ ] NF4.1 界面简洁直观
- [ ] NF4.2 操作有明确提示
- [ ] NF4.3 错误信息友好
- [ ] NF4.4 支持快捷操作

---

## 五、成功标准

### 5.1 最小可行产品（MVP）

**Phase 1 - 核心功能**:
- [ ] 设备发现与注册（Frame、Encode）
- [ ] Blade 状态查看
- [ ] 用户管理（管理员和普通用户）
- [ ] 角色和权限管理
- [ ] Blade 分配和收回
- [ ] Decode 登录和获取 Blade 列表
- [ ] 中继服务器配置

**Phase 2 - 增强功能**:
- [ ] 版本管理和推送
- [ ] 镜像管理集成
- [ ] 告警管理
- [ ] 仪表盘和统计
- [ ] 日志查看和审计

### 5.2 验收标准
- [ ] 所有 MVP 用户故事的验收标准全部通过
- [ ] 通过压力测试：2000 用户同时在线
- [ ] 通过安全测试：无高危漏洞
- [ ] 通过端到端测试：核心业务流程覆盖

---

## 六、约束与限制

### 6.1 技术约束
- 设备必须在同一局域网
- 系统不管理视频流业务
- 使用第三方镜像管理系统（IMS）

### 6.2 业务约束
- 一个 Blade 只能分配给一个用户
- 一个用户只能分配一个角色
- 创建用户时必须选择策略
- 创建管理员时必须选择角色

### 6.3 暂不支持的功能
- 多租户
- 跨地域管理
- Blade 使用审计日志
- Encode 多路输入

---

## 七、术语表

| 术语 | 定义 |
|------|------|
| Frame | 机框，可容纳多个 Blade 的机架式设备 |
| Blade | 刀片，插入 Frame 的功能板卡 |
| Encode | 编码卡，Blade 的子模块，负责视频采集和编码 |
| Decode | 解码盒，用户终端设备 |
| IMS | Image Management System，镜像管理系统 |
| 中继服务器 | 负责转发 Encode 和 Decode 之间数据的第三方服务 |
| 用户策略 | 定义用户可使用的资源类型和默认配置的规则 |
| 角色 | 权限的集合，用于控制用户的功能访问 |

---

*本文档版本 1.0，最后更新 2025-01-07*
